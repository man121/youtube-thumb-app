<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube Thumbnail Generator</title>
  <style>
    :root { --bg:#f8fafc; --text:#0f172a; --muted:#475569; --primary:#0ea5e9; --secondary:#1e293b; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:1fr 2fr;gap:16px}
    @media (max-width:980px){.container{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .card__body{padding:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .muted{color:var(--muted);font-size:12px}
    .notice{font-size:12px;color:#9ca3af}
    label{font-size:14px;display:block;margin-bottom:4px}
    input[type=text],textarea,select{width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:8px;font-size:14px}
    input[type=color]{width:100%;height:38px;border:1px solid #cbd5e1;border-radius:8px;background:#fff;padding:0}
    input[type=file]{width:100%}
    input[type=range]{width:100%}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btnbar{display:flex;flex-wrap:wrap;gap:8px}
    .preview-wrap{display:flex;justify-content:center}
    .canvas-shell{border:1px solid #e5e7eb;background:#fff;border-radius:14px;padding:8px;box-shadow:inset 0 1px 4px rgba(0,0,0,.05);position:relative}
    .tests, .log{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0b1220;color:#d1e5ff;padding:12px;border-radius:10px;white-space:pre-wrap;max-height:220px;overflow:auto}
    .header{padding:8px 16px}
    h1{font-size:22px;margin:0 0 6px}
    .loading-overlay{position:absolute;inset:8px;display:none;align-items:center;justify-content:center;background:rgba(255,255,255,.55);backdrop-filter:blur(1px);border-radius:12px;z-index:10}
    .loading-overlay.active{display:flex}
    .spinner{width:42px;height:42px;border:4px solid #e5e7eb;border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (prefers-reduced-motion:reduce){.spinner{animation:none}}
    code.small { font-size: 12px; }
  </style>
</head>
<body>
  <noscript><div style="padding:12px;background:#fee2e2;color:#7f1d1d">JavaScript is disabled or blocked—buttons won’t work. Enable JavaScript.</div></noscript>

  <div class="header">
    <h1>YouTube Thumbnail Generator</h1>
    <div class="muted">1280×720 export • AI via <code class="small" id="aiEndpointLabel">detecting…</code></div>
  </div>

  <div class="container">
    <!-- Controls -->
    <div class="card"><div class="card__body">
      <div class="mb-3 muted">Sources</div>

      <div class="mb-3">
        <label for="ytUrl">YouTube URL or ID</label>
        <div class="row">
          <input id="ytUrl" type="text" placeholder="https://youtube.com/watch?v=... or 11-char ID" />
          <button id="btnUseYT" class="btn">Use video thumbnail</button>
        </div>
        <div class="notice">We fetch from <code>img.youtube.com</code>. Export may fail due to CORS; use Upload or AI for exporting.</div>
      </div>

      <div class="mb-3">
        <label>Upload background image</label>
        <input id="fileBg" type="file" accept="image/*" />
      </div>

      <div class="mb-4">
        <label for="aiPrompt">AI Background Prompt</label>
        <textarea id="aiPrompt" rows="2" placeholder="e.g., epic neon cyberpunk city, high contrast, bokeh"></textarea>
        <div class="row" style="margin-top:8px">
          <div>
            <label for="imgSize">Quality</label>
            <select id="imgSize">
              <option value="1024x1024" selected>Fast (1024×1024)</option>
              <option value="1536x1024">Detailed (1536×1024)</option>
              <option value="1024x1536">Portrait (1024×1536)</option>
              <option value="auto">Auto</option>
            </select>
          </div>
          <div style="display:flex;align-items:flex-end">
            <button id="btnAI" class="btn" style="width:100%">Generate (OpenAI Images)</button>
          </div>
        </div>
        <div class="notice">
          <button id="btnTestAI" class="btn" style="margin-left:0">Test AI Endpoint</button>
        </div>
      </div>

      <div class="mb-3" style="border-top:1px solid #e5e7eb; padding-top: 12px;">
        <div class="row">
          <div><label>Title</label><input id="title" type="text" value="How to Build a Thumbnail Generator" /></div>
          <div><label>Subtitle</label><input id="subtitle" type="text" value="Step-by-step in 10 minutes" /></div>
        </div>
        <div class="row" style="margin-top:8px">
          <div><label>Title size (<span id="lblTitleSize">120</span>px)</label><input id="titleSize" type="range" min="48" max="160" step="1" value="120" /></div>
          <div><label>Subtitle size (<span id="lblSubtitleSize">56</span>px)</label><input id="subtitleSize" type="range" min="28" max="96" step="1" value="56" /></div>
        </div>
        <div class="row" style="margin-top:8px">
          <div><label>Stroke width (<span id="lblStroke">8</span>px)</label><input id="strokeWidth" type="range" min="0" max="16" step="1" value="8" /></div>
          <div><label>Shadow</label><select id="shadow"><option value="on" selected>On</option><option value="off">Off</option></select></div>
        </div>
        <div class="row" style="margin-top:8px">
          <div><label>Layout</label><select id="layout"><option value="left" selected>Left</option><option value="center">Center</option><option value="right">Right</option></select></div>
          <div><label>Background Fit</label><select id="fit"><option value="cover" selected>Cover</option><option value="contain">Contain</option><option value="stretch">Stretch</option></select></div>
        </div>
      </div>

      <div class="mb-3">
        <div class="row-3">
          <div><label>Primary</label><input id="colorPrimary" type="color" value="#0ea5e9" /></div>
          <div><label>Secondary</label><input id="colorSecondary" type="color" value="#1e293b" /></div>
          <div><label>Text</label><input id="colorText" type="color" value="#ffffff" /></div>
        </div>
      </div>

      <div class="mb-3">
        <label>Logo (optional)</label>
        <input id="fileLogo" type="file" accept="image/*" />
      </div>

      <div class="mb-3">
        <label class="mb-2">Templates</label>
        <div class="btnbar">
          <button id="tplElementary" class="btn">PBMA • Elementary (Reef)</button>
          <button id="tplSecondary" class="btn">PBMA • Secondary (Navy)</button>
          <button id="tplAthletics" class="btn">PBMA • Athletics (Bold)</button>
        </div>
      </div>

      <div class="btnbar">
        <button id="btnExport" class="btn primary">Export PNG</button>
      </div>

      <div class="muted" style="border-top:1px solid #e5e7eb;margin-top:12px;padding-top:12px">Status & Errors:</div>
      <pre id="log" class="log"></pre>
      <div class="muted" style="margin-top:12px">Tests (dev):</div>
      <div id="tests" class="tests"></div>
    </div></div>

    <!-- Preview -->
    <div class="card"><div class="card__body preview-wrap">
      <div class="canvas-shell" aria-live="polite">
        <canvas id="canvas" width="1280" height="720" style="width:640px;height:360px;display:block;"></canvas>
        <div id="loadingOverlay" class="loading-overlay" aria-hidden="true">
          <div class="spinner" role="status" aria-label="Generating image…"></div>
        </div>
      </div>
    </div></div>
  </div>

  <!-- Load external JS from /assets to avoid inline-script blocking -->
  <script src="/assets/app.js?v=1" defer></script>
</body>
</html>
